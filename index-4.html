<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Zahra Bowl">
<meta name="theme-color" content="#0F1419">
<title>Zahra Bowl ‚Äî Yatƒ±rƒ±mcƒ± Paneli</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800;900&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#0F1419;--s1:#141c26;--s2:#1a2535;--bd:#1e2f42;
  --or:#F57C00;--or2:rgba(245,124,0,.13);--or3:rgba(245,124,0,.35);
  --cr:#F5EDD6;--tx:#e8dcc8;--mu:#6b7e96;
  --gn:#22c55e;--am:#f59e0b;--rd:#ef4444;
}
body{background:var(--bg);color:var(--tx);font-family:'DM Sans',sans-serif;min-height:100vh;-webkit-font-smoothing:antialiased;overscroll-behavior:none}
h1,h2,h3{font-family:'Inter',system-ui,sans-serif}

/* STATUS BAR */
#statusBar{position:sticky;top:0;z-index:100;padding:12px 18px;display:flex;align-items:center;justify-content:space-between;backdrop-filter:blur(20px);border-bottom:1px solid rgba(255,255,255,.06);transition:background .4s}
#statusBar.green{background:rgba(34,197,94,.18);border-bottom-color:rgba(34,197,94,.3)}
#statusBar.amber{background:rgba(245,158,11,.18);border-bottom-color:rgba(245,158,11,.3)}
#statusBar.red{background:rgba(239,68,68,.18);border-bottom-color:rgba(239,68,68,.3)}
.sdot{width:10px;height:10px;border-radius:50%;animation:blink 2s infinite;flex-shrink:0}
#statusBar.green .sdot{background:var(--gn);box-shadow:0 0 10px var(--gn)}
#statusBar.amber .sdot{background:var(--am);box-shadow:0 0 10px var(--am)}
#statusBar.red   .sdot{background:var(--rd);box-shadow:0 0 10px var(--rd)}
@keyframes blink{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.5;transform:scale(1.5)}}
.stxt h2{font-size:11px;font-weight:700;letter-spacing:.07em;text-transform:uppercase}
.stxt p{font-size:11px;color:var(--mu);margin-top:2px}
#statusBar.green .stxt h2{color:#4ade80}
#statusBar.amber .stxt h2{color:#fcd34d}
#statusBar.red   .stxt h2{color:#f87171}

/* LAYOUT */
.wrap{max-width:540px;margin:0 auto;padding:0 16px 120px}

/* HEADER */
.hdr{padding:20px 0 14px;display:flex;justify-content:space-between;align-items:flex-start}
.brand{font-size:24px;font-weight:800;color:var(--cr);letter-spacing:-.02em}
.brand span{color:var(--or)}
.bdate{font-size:11px;color:var(--mu);margin-top:3px}

/* SEGMENT */
.seg{display:flex;background:var(--s2);border-radius:10px;padding:3px;margin-bottom:16px;border:1px solid var(--bd)}
.seg button{flex:1;border:none;background:transparent;color:var(--mu);font-family:'Inter',system-ui,sans-serif;font-size:13px;font-weight:700;padding:8px 0;border-radius:7px;cursor:pointer;transition:all .2s}
.seg button.on{background:var(--or);color:#fff;box-shadow:0 2px 12px var(--or3)}

/* KPI GRID */
.kgrid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px}
.kcard{background:var(--s1);border:1px solid var(--bd);border-top:2px solid rgba(245,124,0,.4);border-radius:14px;padding:14px 12px;position:relative;overflow:hidden;transition:transform .2s;min-width:0;box-sizing:border-box}
.kcard.feat{border-color:var(--or);border-top-color:var(--or);box-shadow:0 0 20px var(--or2)}
.klbl{font-size:10px;color:var(--mu);letter-spacing:.04em;margin-bottom:6px;font-weight:500;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.kval{font-family:'Inter',system-ui,sans-serif;font-size:clamp(13px,4.2vw,20px);font-weight:800;color:var(--cr);line-height:1.2;display:block;width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.kcard.feat .kval{color:var(--or)}
.ksub{font-size:10px;color:var(--mu);margin-top:5px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}

/* CARD */
.card{background:var(--s1);border:1px solid var(--bd);border-radius:16px;padding:18px;margin-bottom:14px}
.ctitle{display:flex;align-items:center;gap:8px;font-family:'Inter',system-ui,sans-serif;font-size:13px;font-weight:700;color:var(--cr);margin-bottom:14px}
.ctitle svg{color:var(--or)}

/* CHART */
.chart-area{width:100%;height:210px;position:relative}
.chart-area svg{width:100%;height:100%}
.chart-tooltip{position:absolute;background:#1a2535;border:1px solid #F57C00;border-radius:8px;padding:7px 10px;font-size:11px;color:#e8dcc8;pointer-events:none;display:none;white-space:nowrap;z-index:10}
.chart-legend{display:flex;gap:14px;margin-top:8px;font-size:10px;color:#6b7e96}
.leg-dot{width:8px;height:8px;border-radius:2px;display:inline-block;margin-right:4px}

/* ACTIONS */
.acts{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px}
.btn{display:inline-flex;align-items:center;gap:6px;border:none;cursor:pointer;border-radius:9px;font-family:'DM Sans',sans-serif;font-weight:500;font-size:13px;padding:9px 14px;transition:all .2s;-webkit-tap-highlight-color:transparent}
.btn-p{background:var(--or);color:#fff;box-shadow:0 4px 16px var(--or3)}
.btn-p:active{background:#d96e00}
.btn-o{background:var(--or2);color:var(--or);border:1px solid rgba(245,124,0,.3)}
.btn-o:active{background:rgba(245,124,0,.25)}
.btn-g{background:var(--s2);color:var(--mu);border:1px solid var(--bd)}
.btn-g:active{color:var(--cr)}

/* NOTE */
.note{background:var(--s1);border:1px solid var(--bd);border-radius:12px;padding:13px;font-size:12px;color:var(--mu);line-height:1.7}
.note strong{color:var(--or)}

/* FORM VIEW */
#formView{display:none;padding:20px 0}
.back{display:inline-flex;align-items:center;gap:5px;color:var(--mu);font-size:13px;cursor:pointer;background:none;border:none;margin-bottom:18px;-webkit-tap-highlight-color:transparent}
.ftitle{font-size:24px;font-weight:800;color:var(--cr);margin-bottom:3px}
.fsub{font-size:13px;color:var(--mu);margin-bottom:20px}
.igrp{margin-bottom:16px}
.ilbl{display:block;font-family:'Inter',system-ui,sans-serif;font-size:13px;font-weight:700;color:var(--cr);margin-bottom:6px}
.ifield{width:100%;background:var(--bg);border:1.5px solid var(--bd);border-radius:12px;color:var(--cr);font-family:'DM Sans',sans-serif;font-size:20px;padding:14px 16px;outline:none;transition:border-color .2s,box-shadow .2s;-webkit-appearance:none;appearance:none}
.ifield:focus{border-color:var(--or);box-shadow:0 0 0 3px var(--or2)}
.ifield::placeholder{color:var(--mu)}
.crow{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:16px;padding-top:16px;border-top:1px solid var(--bd)}
.cbox{background:var(--bg);border-radius:10px;padding:13px}
.clbl{font-size:10px;color:var(--mu);letter-spacing:.04em;margin-bottom:4px;font-weight:500}
.cval{font-family:'Inter',system-ui,sans-serif;font-size:clamp(15px,4vw,20px);font-weight:800;word-break:break-word;overflow-wrap:break-word}
.csub{font-size:10px;color:var(--mu);margin-top:2px}
.wbox{display:flex;align-items:flex-start;gap:8px;padding:10px 12px;border-radius:8px;margin-top:10px;font-size:12px;line-height:1.5}
.wred{background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.3);color:#f87171}
.wamb{background:rgba(245,158,11,.1);border:1px solid rgba(245,158,11,.3);color:#fcd34d}
.subbtn{width:100%;background:var(--or);color:#fff;border:none;border-radius:14px;padding:17px;font-family:'Inter',system-ui,sans-serif;font-size:15px;font-weight:800;cursor:pointer;margin-top:16px;box-shadow:0 6px 24px var(--or3);transition:all .2s;letter-spacing:.02em;-webkit-tap-highlight-color:transparent}
.subbtn:active{background:#d96e00;transform:scale(.98)}
.subbtn:disabled{opacity:.5;cursor:not-allowed}
.sucbox{display:flex;align-items:center;gap:8px;padding:13px 15px;background:rgba(34,197,94,.1);border:1px solid rgba(34,197,94,.3);border-radius:10px;margin-top:12px;color:#4ade80;font-size:13px}

/* TOAST */
#toastWrap{position:fixed;bottom:90px;left:50%;transform:translateX(-50%);z-index:999;display:flex;flex-direction:column;gap:8px;align-items:center;pointer-events:none}
.toast{background:var(--s2);border:1px solid var(--bd);color:var(--cr);padding:10px 20px;border-radius:30px;font-size:13px;font-weight:500;animation:sup .3s ease;box-shadow:0 4px 20px rgba(0,0,0,.5);white-space:nowrap}
.toast.ok{border-color:rgba(34,197,94,.4);color:#4ade80}
.toast.err{border-color:rgba(239,68,68,.4);color:#f87171}
@keyframes sup{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}

/* IMPORT MODAL */
#modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.75);z-index:200;align-items:flex-end;justify-content:center;padding:0 16px}
#modal.show{display:flex}
.mbox{background:var(--s2);border:1px solid var(--bd);border-radius:20px 20px 0 0;padding:24px;width:100%;max-width:540px;animation:sup .3s ease}
.mbox h3{font-family:'Inter',system-ui,sans-serif;font-size:16px;font-weight:700;color:var(--cr);margin-bottom:8px}
.mbox p{font-size:12px;color:var(--mu);margin-bottom:12px}
.mbox textarea{width:100%;height:90px;background:var(--bg);border:1.5px solid var(--bd);border-radius:10px;color:var(--cr);padding:12px;font-size:12px;font-family:monospace;resize:none;outline:none}
.mbox textarea:focus{border-color:var(--or)}
.mbtns{display:flex;gap:10px;margin-top:12px}
</style>
</head>
<body>

<!-- STATUS BAR -->
<div id="statusBar" class="green">
  <div class="stxt">
    <h2 id="statusTitle">Sƒ∞STEM OPTƒ∞Mƒ∞ZE ‚Äî Y√úKSEK VERƒ∞MLƒ∞Lƒ∞K</h2>
    <p id="statusSub">K√¢r: %0 ¬∑ Atƒ±k: %0</p>
  </div>
  <div class="sdot"></div>
</div>

<!-- DASHBOARD -->
<div id="dashView">
  <div class="wrap">
    <!-- Header -->
    <div class="hdr">
      <div>
        <div class="brand">ZAHRA <span>BOWL</span></div>
        <div class="bdate" id="dateStr">‚Äî</div>
      </div>
      <button class="btn btn-p" onclick="showForm()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
        Veri Gir
      </button>
    </div>

    <!-- Segment -->
    <div class="seg">
      <button id="seg-daily" class="on" onclick="setPeriod('daily')">G√ºnl√ºk</button>
      <button id="seg-weekly" onclick="setPeriod('weekly')">Haftalƒ±k</button>
      <button id="seg-monthly" onclick="setPeriod('monthly')">Aylƒ±k</button>
    </div>

    <!-- KPI Grid -->
    <div class="kgrid">
      <div class="kcard" style="grid-column:span 2">
        <div class="klbl">Ciro</div>
        <div class="kval" id="kRevenue">DH0</div>
        <div class="ksub">Toplam DH</div>
      </div>
      <div class="kcard" style="grid-column:span 2">
        <div class="klbl">Satƒ±≈ü</div>
        <div class="kval" id="kBowls">0</div>
        <div class="ksub">Kase adedi</div>
      </div>
    </div>

    <!-- Chart -->
    <div class="card">
      <div class="ctitle">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
        <span id="chartTitle">G√ºnl√ºk Kase Satƒ±≈üƒ± ‚Äî Son 7 G√ºn</span>
      </div>
      <div class="chart-area" style="position:relative">
        <svg id="chartSvg" viewBox="0 0 320 180" preserveAspectRatio="none" style="width:100%;height:100%"></svg>
        <div id="chartTooltip" class="chart-tooltip"></div>
      </div>
      <div class="chart-legend">
        <span><span class="leg-dot" style="background:#F57C00"></span>Bug√ºn</span>
        <span><span class="leg-dot" style="background:rgba(245,124,0,0.35)"></span>√ñnceki g√ºnler</span>
        <span style="margin-left:auto;font-size:10px;color:#6b7e96">Son 7 G√ºn</span>
      </div>
    </div>

    <!-- D√ºr√ºm Satƒ±≈ü Bloƒüu -->
    <div class="card" id="durumBlock">
      <div class="ctitle">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 11l19-9-9 19-2-8-8-2z"/></svg>
        D√ºr√ºm Satƒ±≈ülarƒ±
        <span id="durumBadge" style="margin-left:auto;background:var(--or2);color:var(--or);border:1px solid rgba(245,124,0,.3);border-radius:20px;padding:2px 9px;font-size:10px;font-weight:700"></span>
      </div>
      <div class="kgrid" style="margin-bottom:14px">
        <div class="kcard" style="grid-column:span 2">
          <div class="klbl">Ciro</div>
          <div class="kval" id="dRevenue">DH0</div>
          <div class="ksub">Toplam DH</div>
        </div>
        <div class="kcard" style="grid-column:span 2">
          <div class="klbl">Satƒ±≈ü</div>
          <div class="kval" id="dCount">0</div>
          <div class="ksub">D√ºr√ºm adedi</div>
        </div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px">
        <div style="background:var(--bg);border-radius:10px;padding:12px;min-width:0">
          <div style="font-size:10px;color:var(--mu);margin-bottom:4px;letter-spacing:.06em">Ortalama Fiyat</div>
          <div style="font-family:'Inter',system-ui,sans-serif;font-size:20px;font-weight:800;color:var(--cr);white-space:nowrap;overflow:hidden;text-overflow:ellipsis" id="dAvgPrice">DH0</div>
        </div>
        <div style="background:var(--bg);border-radius:10px;padding:12px;min-width:0">
          <div style="font-size:10px;color:var(--mu);margin-bottom:4px;letter-spacing:.06em">Gider</div>
          <div style="font-family:'Inter',system-ui,sans-serif;font-size:20px;font-weight:800;color:var(--cr);white-space:nowrap;overflow:hidden;text-overflow:ellipsis" id="dExpenses">DH0</div>
        </div>
        <div style="background:var(--bg);border-radius:10px;padding:12px;min-width:0;grid-column:span 2">
          <div style="font-size:10px;color:var(--mu);margin-bottom:4px;letter-spacing:.06em">Toplam Ciro</div>
          <div style="font-family:'Inter',system-ui,sans-serif;font-size:20px;font-weight:800;color:var(--cr);white-space:nowrap;overflow:hidden;text-overflow:ellipsis" id="dWaste">DH0</div>
        </div>
      </div>
      <!-- D√ºr√ºm Grafik -->
      <div style="display:flex;background:var(--s2);border-radius:10px;padding:3px;margin-bottom:12px;border:1px solid var(--bd)">
        <button id="dseg-daily" class="on" onclick="setDurumPeriod('daily')" style="flex:1;border:none;background:transparent;color:var(--mu);font-family:var(--font);font-size:13px;font-weight:700;padding:8px 0;border-radius:7px;cursor:pointer;transition:all .2s">G√ºnl√ºk</button>
        <button id="dseg-weekly" onclick="setDurumPeriod('weekly')" style="flex:1;border:none;background:transparent;color:var(--mu);font-family:var(--font);font-size:13px;font-weight:700;padding:8px 0;border-radius:7px;cursor:pointer;transition:all .2s">Haftalƒ±k</button>
        <button id="dseg-monthly" onclick="setDurumPeriod('monthly')" style="flex:1;border:none;background:transparent;color:var(--mu);font-family:var(--font);font-size:13px;font-weight:700;padding:8px 0;border-radius:7px;cursor:pointer;transition:all .2s">Aylƒ±k</button>
      </div>
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#F57C00" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
        <span id="durumChartTitle" style="font-size:13px;font-weight:700;color:var(--cr)">D√ºr√ºm Satƒ±≈üƒ± ‚Äî Son 7 G√ºn</span>
      </div>
      <div style="width:100%;height:180px;position:relative">
        <svg id="durumChartSvg" viewBox="0 0 320 160" preserveAspectRatio="none" style="width:100%;height:100%"></svg>
        <div id="durumChartTooltip" class="chart-tooltip"></div>
      </div>
      <div class="chart-legend" style="margin-top:8px">
        <span><span class="leg-dot" style="background:#F57C00"></span>Bu d√∂nem</span>
        <span><span class="leg-dot" style="background:rgba(245,124,0,0.35)"></span>√ñnceki</span>
      </div>
    </div>

    <!-- Actions -->
    <div class="acts">
      <button class="btn btn-o" onclick="shareWhatsApp()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></svg>
        WhatsApp
      </button>
      <button class="btn btn-o" onclick="exportData()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        Dƒ±≈üa Aktar
      </button>
      <button class="btn btn-g" onclick="document.getElementById('modal').classList.add('show')">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
        ƒ∞√ße Aktar
      </button>
    </div>

    <div class="note"><strong>≈ûeffaflƒ±k Notu:</strong> T√ºm veriler ger√ßek zamanlƒ± g√ºncellenmektedir. Yatƒ±rƒ±mcƒ± g√ºveni ve operasyonel ≈üeffaflƒ±k en y√ºksek √∂nceliƒüimizdir.</div>
  </div>
</div>

<!-- FORM VIEW -->
<div id="formView">
  <div class="wrap">
    <button class="back" onclick="showDash()">
      <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
      Panele D√∂n
    </button>
    <h1 class="ftitle">30 Saniye Giri≈ü</h1>
    <p class="fsub">G√ºn√ºn √∂zetini hƒ±zlƒ±ca girin</p>

    <div class="card" style="padding:22px">
      <div class="igrp">
        <label class="ilbl">G√ºnl√ºk Ciro (DH)</label>
        <input class="ifield" id="fRevenue" type="number" inputmode="decimal" placeholder="8500" oninput="calcLive()">
      </div>
      <div class="igrp">
        <label class="ilbl">Satƒ±lan Kase (Adet)</label>
        <input class="ifield" id="fBowls" type="number" inputmode="numeric" placeholder="285" oninput="calcLive()">
      </div>
      <div class="igrp">
        <label class="ilbl">Toplam Giderler (DH)</label>
        <input class="ifield" id="fExpenses" type="number" inputmode="decimal" placeholder="5000" oninput="calcLive()">
      </div>
      <div class="igrp" style="margin-bottom:0">
        <label class="ilbl">Atƒ±k (Kase Sayƒ±sƒ±)</label>
        <input class="ifield" id="fWaste" type="number" inputmode="numeric" placeholder="15" oninput="calcLive()">
      </div>

      <!-- D√ºr√ºm B√∂l√ºm√º -->
      <div style="margin-top:20px;padding-top:18px;border-top:1px solid var(--bd)">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:14px">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#F57C00" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 11l19-9-9 19-2-8-8-2z"/></svg>
          <span style="font-family:'Inter',system-ui,sans-serif;font-size:13px;font-weight:700;color:var(--cr)">D√ºr√ºm Satƒ±≈ülarƒ±</span>
        </div>
        <div class="igrp">
          <label class="ilbl">D√ºr√ºm Cirosu (DH)</label>
          <input class="ifield" id="fDurumRevenue" type="number" inputmode="decimal" placeholder="3200" oninput="calcLive()">
        </div>
        <div class="igrp">
          <label class="ilbl">Satƒ±lan D√ºr√ºm (Adet)</label>
          <input class="ifield" id="fDurumCount" type="number" inputmode="numeric" placeholder="80" oninput="calcLive()">
        </div>
        <div class="igrp">
          <label class="ilbl">D√ºr√ºm Giderleri (DH)</label>
          <input class="ifield" id="fDurumExpenses" type="number" inputmode="decimal" placeholder="1800" oninput="calcLive()">
        </div>
        <div class="igrp" style="margin-bottom:0">
          <label class="ilbl">D√ºr√ºm Atƒ±ƒüƒ± (Adet)</label>
          <input class="ifield" id="fDurumWaste" type="number" inputmode="numeric" placeholder="5" oninput="calcLive()">
        </div>
      </div>

      <div class="crow">
        <div class="cbox">
          <div class="clbl">Net K√¢r</div>
          <div class="cval" id="liveProfit" style="color:var(--or)">0 DH</div>
          <div class="csub" id="liveProfitPct">%0 marj</div>
        </div>
        <div class="cbox">
          <div class="clbl">Atƒ±k Oranƒ±</div>
          <div class="cval" id="liveWaste" style="color:var(--gn)">%0</div>
          <div class="csub" id="liveWasteSub">0 kase</div>
        </div>
      </div>

      <div id="warnProfit" class="wbox wred" style="display:none">
        ‚ö†Ô∏è K√¢r marjƒ± kritik seviyede! Acil √∂nlem alƒ±nmalƒ±.
      </div>
      <div id="warnWaste" class="wbox wamb" style="display:none">
        ‚ö†Ô∏è Atƒ±k oranƒ± y√ºksek! Tedarik planlamasƒ±nƒ± g√∂zden ge√ßirin.
      </div>
    </div>

    <button class="subbtn" id="saveBtn" onclick="saveData()">Verileri Kaydet &amp; Panele D√∂n</button>
    <div id="sucMsg" class="sucbox" style="display:none">‚úÖ Veriler ba≈üarƒ±yla kaydedildi!</div>
  </div>
</div>

<!-- IMPORT MODAL -->
<div id="modal" onclick="if(event.target===this)this.classList.remove('show')">
  <div class="mbox">
    <h3>Veri ƒ∞√ße Aktar</h3>
    <p>Senkronizasyon kodunu a≈üaƒüƒ±ya yapƒ±≈ütƒ±rƒ±n:</p>
    <textarea id="importInput" placeholder="Base64 kodu buraya..."></textarea>
    <div class="mbtns">
      <button class="btn btn-g" style="flex:1" onclick="document.getElementById('modal').classList.remove('show')">ƒ∞ptal</button>
      <button class="btn btn-p" style="flex:2" onclick="importData()">ƒ∞√ße Aktar</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div id="toastWrap"></div>

<script>
// ‚îÄ‚îÄ‚îÄ DEFAULT DATA ‚îÄ‚îÄ‚îÄ
var defaultData = {
  date: new Date().toISOString().split('T')[0],
  totalSales: 0,
  expenses: 0,
  soldPortions: 0,
  suppliedPortions: 0,
  durumRevenue: 0,
  durumCount: 0,
  durumExpenses: 0,
  durumWaste: 0
};

var appData = defaultData;
var period = 'daily';

// SHEETDB API Lƒ∞NKƒ∞
var SHEETDB_URL = 'https://sheetdb.io/api/v1/e1gjqprd0b9hu';

// ‚îÄ‚îÄ‚îÄ LOAD FROM LOCALSTORAGE ‚îÄ‚îÄ‚îÄ
try {
  var saved = localStorage.getItem('zahrabowl');
  if (saved) appData = JSON.parse(saved);
} catch(e) {}

// ‚îÄ‚îÄ‚îÄ SHEETDB'DEN VERƒ∞ √áEK (T√úM KAYITLAR) ‚îÄ‚îÄ‚îÄ
function fetchLatest() {
  console.log('SheetDB verisi √ßekiliyor...');
  
  fetch(SHEETDB_URL + '?limit=100')
    .then(function(response) {
      if (!response.ok) {
        throw new Error('API yanƒ±t vermedi');
      }
      return response.json();
    })
    .then(function(data) {
      console.log('Gelen veri sayƒ±sƒ±:', data.length);
      
      // T√ºm verileri localStorage'a kaydet (grafikler i√ßin)
      try { 
        localStorage.setItem('zahrabowl_all', JSON.stringify(data)); 
      } catch(e) {}
      
      if (Array.isArray(data) && data.length > 0) {
        // En son eklenen kaydƒ± al
        var lastRow = data[data.length - 1];
        console.log('Son kayƒ±t:', lastRow);
        
        // Verileri appData'ya ata
        appData.date = lastRow.date || new Date().toISOString().split('T')[0];
        appData.totalSales = parseFloat(lastRow.totalSales) || 0;
        appData.expenses = parseFloat(lastRow.expenses) || 0;
        appData.soldPortions = parseFloat(lastRow.soldPortions) || 0;
        appData.suppliedPortions = parseFloat(lastRow.suppliedPortions) || 0;
        appData.durumRevenue = parseFloat(lastRow.durumRevenue) || 0;
        appData.durumCount = parseFloat(lastRow.durumCount) || 0;
        appData.durumExpenses = parseFloat(lastRow.durumExpenses) || 0;
        appData.durumWaste = parseFloat(lastRow.durumWaste) || 0;
        
        try { localStorage.setItem('zahrabowl', JSON.stringify(appData)); } catch(e) {}
        
        render();
        toast('Veriler g√ºncellendi!', 'ok');
      } else {
        console.log('Veri bulunamadƒ±');
        toast('Veri bulunamadƒ±!', 'err');
      }
    })
    .catch(function(error) {
      console.log('Hata:', error);
      toast('Veri √ßekilemedi!', 'err');
    });
}

// ƒ∞lk y√ºkleme + her 30 saniyede g√ºncelle
fetchLatest();
setInterval(fetchLatest, 30000);

// ‚îÄ‚îÄ‚îÄ SAVE ‚îÄ‚îÄ‚îÄ
function persist() {
  try { localStorage.setItem('zahrabowl', JSON.stringify(appData)); } catch(e) {}
}

// ‚îÄ‚îÄ‚îÄ VIEWS ‚îÄ‚îÄ‚îÄ
function showForm() {
  document.getElementById('dashView').style.display = 'none';
  document.getElementById('formView').style.display = 'block';
  document.getElementById('fRevenue').value  = appData.totalSales;
  document.getElementById('fBowls').value    = appData.soldPortions;
  document.getElementById('fExpenses').value = appData.expenses;
  document.getElementById('fWaste').value    = (appData.suppliedPortions - appData.soldPortions) || 0;
  document.getElementById('fDurumRevenue').value   = appData.durumRevenue || '';
  document.getElementById('fDurumCount').value     = appData.durumCount || '';
  document.getElementById('fDurumExpenses').value  = appData.durumExpenses || '';
  document.getElementById('fDurumWaste').value     = appData.durumWaste || '';
  document.getElementById('sucMsg').style.display = 'none';
  calcLive();
}
function showDash() {
  document.getElementById('dashView').style.display = 'block';
  document.getElementById('formView').style.display = 'none';
  render();
}

// ‚îÄ‚îÄ‚îÄ LIVE CALC IN FORM ‚îÄ‚îÄ‚îÄ
function calcLive() {
  var rev  = parseFloat(document.getElementById('fRevenue').value)  || 0;
  var bwls = parseFloat(document.getElementById('fBowls').value)    || 0;
  var exp  = parseFloat(document.getElementById('fExpenses').value) || 0;
  var wst  = parseFloat(document.getElementById('fWaste').value)    || 0;
  var supplied = bwls + wst;
  var profit   = rev - exp;
  var pPct     = rev > 0 ? (profit / rev * 100) : 0;
  var wPct     = supplied > 0 ? (wst / supplied * 100) : 0;

  var pEl = document.getElementById('liveProfit');
  pEl.textContent = fmt(profit) + ' DH';
  pEl.style.color = profit >= 0 ? 'var(--or)' : 'var(--rd)';
  document.getElementById('liveProfitPct').textContent = '%' + pPct.toFixed(1) + ' marj';

  var wEl = document.getElementById('liveWaste');
  wEl.textContent = '%' + wPct.toFixed(1);
  wEl.style.color = wPct <= 5 ? 'var(--gn)' : wPct <= 10 ? 'var(--am)' : 'var(--rd)';
  document.getElementById('liveWasteSub').textContent = wst + ' kase';

  document.getElementById('warnProfit').style.display = (pPct < 10 && rev > 0) ? 'flex' : 'none';
  document.getElementById('warnWaste').style.display  = (wPct > 10) ? 'flex' : 'none';
}

// ‚îÄ‚îÄ‚îÄ SAVE DATA ‚îÄ‚îÄ‚îÄ
function saveData() {
  var rev  = parseFloat(document.getElementById('fRevenue').value)  || 0;
  var bwls = parseFloat(document.getElementById('fBowls').value)    || 0;
  var exp  = parseFloat(document.getElementById('fExpenses').value) || 0;
  var wst  = parseFloat(document.getElementById('fWaste').value)    || 0;

  appData.totalSales       = rev;
  appData.expenses         = exp;
  appData.soldPortions     = bwls;
  appData.suppliedPortions = bwls + wst;
  appData.durumRevenue     = parseFloat(document.getElementById('fDurumRevenue').value)  || 0;
  appData.durumCount       = parseFloat(document.getElementById('fDurumCount').value)    || 0;
  appData.durumExpenses    = parseFloat(document.getElementById('fDurumExpenses').value) || 0;
  appData.durumWaste       = parseFloat(document.getElementById('fDurumWaste').value)    || 0;
  appData.date             = new Date().toISOString().split('T')[0];
  persist();

  var btn = document.getElementById('saveBtn');
  btn.disabled = true;
  btn.textContent = 'Kaydediliyor...';
  document.getElementById('sucMsg').style.display = 'flex';
  
  // SheetDB'ye POST yap
  fetch(SHEETDB_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      date: appData.date,
      totalSales: appData.totalSales,
      expenses: appData.expenses,
      soldPortions: appData.soldPortions,
      suppliedPortions: appData.suppliedPortions,
      durumRevenue: appData.durumRevenue,
      durumCount: appData.durumCount,
      durumExpenses: appData.durumExpenses,
      durumWaste: appData.durumWaste
    })
  }).catch(function(e) { console.log('SheetDB kayƒ±t hatasƒ±:', e); });
  
  setTimeout(function() {
    btn.disabled = false;
    btn.textContent = 'Verileri Kaydet & Panele D√∂n';
    showDash();
  }, 1200);
}

// ‚îÄ‚îÄ‚îÄ PERIOD ‚îÄ‚îÄ‚îÄ
function setPeriod(p) {
  period = p;
  ['daily','weekly','monthly'].forEach(function(x) {
    document.getElementById('seg-' + x).classList.toggle('on', x === p);
  });
  render();
}

// ‚îÄ‚îÄ‚îÄ FORMAT NUMBER ‚îÄ‚îÄ‚îÄ
function fmt(n) {
  if (n >= 1000000) return (n/1000000).toFixed(1) + 'M';
  if (n >= 1000)    return (n/1000).toFixed(1) + 'K';
  return Math.round(n);
}

// ‚îÄ‚îÄ‚îÄ RENDER DASHBOARD ‚îÄ‚îÄ‚îÄ
function render() {
  var mul = period === 'daily' ? 1 : period === 'weekly' ? 7 : 30;
  var sales   = appData.totalSales * mul;
  var exp     = appData.expenses * mul;
  var profit  = sales - exp;
  var bowls   = appData.soldPortions * mul;
  var pPct    = sales > 0 ? (profit / sales * 100) : 0;
  var wPct    = appData.suppliedPortions > 0
    ? ((appData.suppliedPortions - appData.soldPortions) / appData.suppliedPortions * 100) : 0;

  // Date
  try {
    document.getElementById('dateStr').textContent =
      new Date(appData.date + 'T12:00:00').toLocaleDateString('tr-TR',{weekday:'long',year:'numeric',month:'long',day:'numeric'});
  } catch(e) {
    document.getElementById('dateStr').textContent = 'Bug√ºn';
  }

  // KPIs
  document.getElementById('kRevenue').textContent = fmt(sales) + ' DH';
  document.getElementById('kBowls').textContent   = Math.round(bowls).toLocaleString('tr-TR');

  // Status bar
  var bar = document.getElementById('statusBar');
  var title = document.getElementById('statusTitle');
  var sub   = document.getElementById('statusSub');
  bar.className = '';
  if (pPct > 20 && wPct < 5) {
    bar.classList.add('green');
    title.textContent = 'Sƒ∞STEM OPTƒ∞Mƒ∞ZE ‚Äî Y√úKSEK VERƒ∞MLƒ∞Lƒ∞K';
  } else if ((pPct >= 10 && pPct <= 20) || (wPct >= 5 && wPct <= 10)) {
    bar.classList.add('amber');
    title.textContent = 'UYARI: MARJ / ATIK SAPMASI';
  } else {
    bar.classList.add('red');
    title.textContent = 'KRƒ∞Tƒ∞K: ACƒ∞L ƒ∞NCELEME GEREKLƒ∞';
  }
  sub.textContent = 'K√¢r: %' + pPct.toFixed(1) + ' ¬∑ Atƒ±k: %' + wPct.toFixed(1);

  // Chart
  drawChart(period);

  // D√ºr√ºm Bloƒüu
  var mul2     = mul;
  var dRev     = (appData.durumRevenue  || 0) * mul2;
  var dExp     = (appData.durumExpenses || 0) * mul2;
  var dCnt     = (appData.durumCount    || 0) * mul2;
  var dWst     = appData.durumWaste     || 0;
  var dProfit  = dRev - dExp;
  var dPPct    = dRev > 0 ? (dProfit / dRev * 100) : 0;
  var dWPct    = (dCnt + dWst) > 0 ? (dWst / (dCnt + dWst) * 100) : 0;
  var dAvg     = dCnt > 0 ? (dRev / dCnt) : 0;

  document.getElementById('dRevenue').textContent   = fmt(dRev) + ' DH';
  document.getElementById('dCount').textContent     = Math.round(dCnt).toLocaleString('tr-TR');
  document.getElementById('dAvgPrice').textContent  = fmt(dAvg) + ' DH';
  document.getElementById('dExpenses').textContent  = fmt(dExp) + ' DH';
  document.getElementById('dWaste').textContent     = fmt(appData.totalSales || 0) + ' DH';
  document.getElementById('durumBadge').textContent = period === 'daily' ? 'G√ºnl√ºk' : period === 'weekly' ? 'Haftalƒ±k' : 'Aylƒ±k';
  
  if (typeof drawDurumChart === 'function') {
    drawDurumChart(durumPeriod || 'daily');
  }
}

// ‚îÄ‚îÄ‚îÄ DRAW BAR CHART - TAKVƒ∞M MANTIƒûIYLA ‚îÄ‚îÄ‚îÄ
function drawChart(p) {
  var svg = document.getElementById('chartSvg');
  var tip = document.getElementById('chartTooltip');
  if (!svg) return;

  // T√ºm kayƒ±tlarƒ± localStorage'dan al
  var allData = [];
  try {
    var saved = localStorage.getItem('zahrabowl_all');
    if (saved) allData = JSON.parse(saved);
  } catch(e) {}
  
  // Tarihe g√∂re sƒ±rala
  allData.sort(function(a, b) { 
    return new Date(a.date) - new Date(b.date); 
  });
  
  var bars = [];
  var today = new Date();
  var dayNames = ['Pzt','Sal','√áar','Per','Cum','Cmt','Paz'];
  var monthNames = ['Oca','≈ûub','Mar','Nis','May','Haz','Tem','Aƒüu','Eyl','Eki','Kas','Ara'];

  if (p === 'daily') {
    document.getElementById('chartTitle').textContent = 'Kase Satƒ±≈üƒ± ‚Äî Son 7 G√ºn';
    
    var last7Days = [];
    for (var i = 6; i >= 0; i--) {
      var d = new Date(today);
      d.setDate(today.getDate() - i);
      var dateStr = d.toISOString().split('T')[0];
      var dayName = dayNames[d.getDay() === 0 ? 6 : d.getDay() - 1];
      
      var dayData = null;
      for (var j = 0; j < allData.length; j++) {
        if (allData[j].date === dateStr) {
          dayData = allData[j];
          break;
        }
      }
      
      var val = dayData ? parseFloat(dayData.soldPortions) || 0 : 0;
      var isLast = (i === 0);
      
      last7Days.push({
        label: dayName,
        val: val,
        isNow: isLast,
        date: dateStr
      });
    }
    bars = last7Days;
    
  } else if (p === 'weekly') {
    document.getElementById('chartTitle').textContent = 'Kase Satƒ±≈üƒ± ‚Äî Son 4 Hafta';
    
    var weeklyData = [];
    var currentDate = new Date(today);
    
    for (var w = 3; w >= 0; w--) {
      var weekStart = new Date(currentDate);
      weekStart.setDate(currentDate.getDate() - (w * 7 + 6));
      var weekEnd = new Date(currentDate);
      weekEnd.setDate(currentDate.getDate() - (w * 7));
      
      var weekTotal = 0;
      var weekLabel = weekStart.getDate() + ' ' + monthNames[weekStart.getMonth()];
      
      for (var k = 0; k < allData.length; k++) {
        var itemDate = new Date(allData[k].date + 'T12:00:00');
        if (itemDate >= weekStart && itemDate <= weekEnd) {
          weekTotal += parseFloat(allData[k].soldPortions) || 0;
        }
      }
      
      weeklyData.push({
        label: weekLabel,
        val: weekTotal,
        isNow: (w === 0)
      });
    }
    bars = weeklyData;
    
  } else {
    document.getElementById('chartTitle').textContent = 'Kase Satƒ±≈üƒ± ‚Äî Son 12 Ay';
    
    var monthlyData = [];
    var currentMonth = new Date(today.getFullYear(), today.getMonth(), 1);
    
    for (var m = 11; m >= 0; m--) {
      var monthDate = new Date(currentMonth);
      monthDate.setMonth(currentMonth.getMonth() - m);
      var monthStr = monthNames[monthDate.getMonth()] + ' ' + monthDate.getFullYear().toString().slice(-2);
      
      var monthTotal = 0;
      
      for (var n = 0; n < allData.length; n++) {
        var itemDate = new Date(allData[n].date + 'T12:00:00');
        if (itemDate.getMonth() === monthDate.getMonth() && 
            itemDate.getFullYear() === monthDate.getFullYear()) {
          monthTotal += parseFloat(allData[n].soldPortions) || 0;
        }
      }
      
      monthlyData.push({
        label: monthStr,
        val: monthTotal,
        isNow: (m === 0)
      });
    }
    bars = monthlyData;
  }

  // GRAFƒ∞ƒûƒ∞ √áƒ∞Z
  var W = 320, H = 180;
  var padL = 28, padR = 8, padT = 12, padB = 22;
  var chartW = W - padL - padR;
  var chartH = H - padT - padB;

  var vals = bars.map(function(b){ return b.val; });
  var maxV = Math.max.apply(null, vals) || 1;

  function fy(v) { return padT + (1 - v / maxV) * chartH; }

  var colW = chartW / bars.length;
  var barW = Math.max(6, colW * 0.6);

  var grid = '';
  for (var g = 0; g <= 4; g++) {
    var gv = (maxV / 4) * g;
    var gy = fy(gv);
    grid += '<line x1="' + padL + '" y1="' + gy + '" x2="' + (W - padR) + '" y2="' + gy + '" stroke="#1e2f42" stroke-width="0.8"/>';
    grid += '<text x="' + (padL - 3) + '" y="' + (gy + 3) + '" text-anchor="end" fill="#6b7e96" font-size="7.5" font-family="Inter,system-ui,sans-serif">' + Math.round(gv) + '</text>';
  }

  var barSvg = '<defs>' +
    '<linearGradient id="bg1" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#F57C00"/><stop offset="100%" stop-color="#c45e00"/></linearGradient>' +
    '<linearGradient id="bg2" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#F57C00" stop-opacity="0.45"/><stop offset="100%" stop-color="#F57C00" stop-opacity="0.15"/></linearGradient>' +
    '</defs>';

  bars.forEach(function(b, i) {
    var cx = padL + i * colW + colW / 2;
    var barTop = fy(b.val);
    var barH = Math.max(3, H - padB - barTop);
    var fill = b.isNow ? 'url(#bg1)' : 'url(#bg2)';
    var stroke = b.isNow ? '#F57C00' : 'none';
    barSvg += '<rect x="' + (cx - barW/2) + '" y="' + barTop + '" width="' + barW + '" height="' + barH + '" rx="3" fill="' + fill + '" stroke="' + stroke + '" stroke-width="1"/>';
    if (b.isNow) {
      barSvg += '<text x="' + cx + '" y="' + (barTop - 4) + '" text-anchor="middle" fill="#F57C00" font-size="8" font-family="Inter,system-ui,sans-serif" font-weight="700">' + Math.round(b.val) + '</text>';
    }
    var fsize = (p === 'monthly') ? '6.5' : '8.5';
    barSvg += '<text x="' + cx + '" y="' + (H - 5) + '" text-anchor="middle" fill="' + (b.isNow ? '#F57C00' : '#6b7e96') + '" font-size="' + fsize + '" font-family="Inter,system-ui,sans-serif" font-weight="' + (b.isNow ? '700' : '400') + '">' + b.label + '</text>';
  });

  svg.innerHTML = grid + barSvg;

  svg.onclick = function(ev) {
    var rect = svg.getBoundingClientRect();
    var svgX = (ev.clientX - rect.left) / rect.width * W;
    var i = Math.floor((svgX - padL) / colW);
    if (i < 0 || i >= bars.length) { tip.style.display = 'none'; return; }
    var b = bars[i];
    tip.innerHTML = '<strong style="color:#F57C00">' + b.label + (b.isNow ? ' ‚òÖ' : '') + '</strong><br>Satƒ±≈ü: <b>' + Math.round(b.val) + ' kase</b>';
    tip.style.display = 'block';
    tip.style.left = Math.min(ev.clientX - rect.left - 40, rect.width - 130) + 'px';
    tip.style.top = '6px';
    setTimeout(function(){ tip.style.display = 'none'; }, 2500);
  };
}

// ‚îÄ‚îÄ‚îÄ DURUM PERIOD ‚îÄ‚îÄ‚îÄ
var durumPeriod = 'daily';
function setDurumPeriod(p) {
  durumPeriod = p;
  ['daily','weekly','monthly'].forEach(function(x) {
    var btn = document.getElementById('dseg-' + x);
    if (btn) {
      btn.style.background = (x === p) ? 'var(--or)' : 'transparent';
      btn.style.color = (x === p) ? '#fff' : 'var(--mu)';
      btn.style.boxShadow = (x === p) ? '0 2px 12px var(--or3)' : 'none';
    }
  });
  drawDurumChart(p);
}

// ‚îÄ‚îÄ‚îÄ DRAW DURUM CHART ‚îÄ‚îÄ‚îÄ
function drawDurumChart(p) {
  var svg = document.getElementById('durumChartSvg');
  var tip = document.getElementById('durumChartTooltip');
  if (!svg) return;

  var base = appData.durumCount || 80;
  var seed = base + 999;
  function nextRand() { seed = (seed * 1103515245 + 12345) & 0x7fffffff; return seed; }

  var bars = [];
  var today = new Date();
  var dayNames = ['Pzt','Sal','√áar','Per','Cum','Cmt','Paz'];
  var monthNames = ['Oca','≈ûub','Mar','Nis','May','Haz','Tem','Aƒüu','Eyl','Eki','Kas','Ara'];

  if (p === 'daily') {
    for (var i = 0; i < 7; i++) {
      var d = new Date(today);
      d.setDate(today.getDate() - (6 - i));
      var dn = dayNames[d.getDay() === 0 ? 6 : d.getDay() - 1];
      nextRand();
      var isLast = (i === 6);
      var val = isLast ? base : Math.max(5, base + ((seed % 40) - 20));
      bars.push({ label: dn, val: val, isNow: isLast });
    }
    document.getElementById('durumChartTitle').textContent = 'D√ºr√ºm Satƒ±≈üƒ± ‚Äî Son 7 G√ºn';
  } else if (p === 'weekly') {
    for (var i = 3; i >= 0; i--) {
      var d = new Date(today);
      d.setDate(today.getDate() - i * 7);
      var label = d.getDate() + ' ' + monthNames[d.getMonth()];
      nextRand();
      var isLast = (i === 0);
      var val = isLast ? base * 7 : Math.max(10, base * 7 + ((seed % 150) - 75));
      bars.push({ label: label, val: val, isNow: isLast });
    }
    document.getElementById('durumChartTitle').textContent = 'D√ºr√ºm Satƒ±≈üƒ± ‚Äî Son 4 Hafta';
  } else {
    for (var i = 11; i >= 0; i--) {
      var d = new Date(today.getFullYear(), today.getMonth() - i, 1);
      var label = monthNames[d.getMonth()];
      nextRand();
      var isLast = (i === 0);
      var val = isLast ? base * 30 : Math.max(50, base * 30 + ((seed % 800) - 400));
      bars.push({ label: label, val: val, isNow: isLast });
    }
    document.getElementById('durumChartTitle').textContent = 'D√ºr√ºm Satƒ±≈üƒ± ‚Äî Son 12 Ay';
  }

  var W = 320, H = 160;
  var padL = 28, padR = 8, padT = 12, padB = 22;
  var chartW = W - padL - padR;
  var chartH = H - padT - padB;

  var vals = bars.map(function(b){ return b.val; });
  var maxV = Math.max.apply(null, vals) || 1;

  function fy(v) { return padT + (1 - v / maxV) * chartH; }

  var colW = chartW / bars.length;
  var barW = Math.max(6, colW * 0.6);

  var grid = '';
  for (var g = 0; g <= 4; g++) {
    var gv = (maxV / 4) * g;
    var gy = fy(gv);
    grid += '<line x1="' + padL + '" y1="' + gy + '" x2="' + (W - padR) + '" y2="' + gy + '" stroke="#1e2f42" stroke-width="0.8"/>';
    grid += '<text x="' + (padL - 3) + '" y="' + (gy + 3) + '" text-anchor="end" fill="#6b7e96" font-size="7.5" font-family="Inter,system-ui,sans-serif">' + Math.round(gv) + '</text>';
  }

  var barSvg = '<defs>' +
    '<linearGradient id="dbg1" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#F57C00"/><stop offset="100%" stop-color="#c45e00"/></linearGradient>' +
    '<linearGradient id="dbg2" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#F57C00" stop-opacity="0.45"/><stop offset="100%" stop-color="#F57C00" stop-opacity="0.15"/></linearGradient>' +
    '</defs>';

  bars.forEach(function(b, i) {
    var cx = padL + i * colW + colW / 2;
    var barTop = fy(b.val);
    var barH = Math.max(3, H - padB - barTop);
    var fill = b.isNow ? 'url(#dbg1)' : 'url(#dbg2)';
    var stroke = b.isNow ? '#F57C00' : 'none';
    barSvg += '<rect x="' + (cx - barW/2) + '" y="' + barTop + '" width="' + barW + '" height="' + barH + '" rx="3" fill="' + fill + '" stroke="' + stroke + '" stroke-width="1"/>';
    if (b.isNow) {
      barSvg += '<text x="' + cx + '" y="' + (barTop - 4) + '" text-anchor="middle" fill="#F57C00" font-size="8" font-family="Inter,system-ui,sans-serif" font-weight="700">' + Math.round(b.val) + '</text>';
    }
    var fsize = (p === 'monthly') ? '6.5' : '8.5';
    barSvg += '<text x="' + cx + '" y="' + (H - 5) + '" text-anchor="middle" fill="' + (b.isNow ? '#F57C00' : '#6b7e96') + '" font-size="' + fsize + '" font-family="Inter,system-ui,sans-serif" font-weight="' + (b.isNow ? '700' : '400') + '">' + b.label + '</text>';
  });

  svg.innerHTML = grid + barSvg;

  svg.onclick = function(ev) {
    var rect = svg.getBoundingClientRect();
    var svgX = (ev.clientX - rect.left) / rect.width * W;
    var i = Math.floor((svgX - padL) / colW);
    if (i < 0 || i >= bars.length) { tip.style.display = 'none'; return; }
    var b = bars[i];
    tip.innerHTML = '<strong style="color:#F57C00">' + b.label + (b.isNow ? ' ‚òÖ' : '') + '</strong><br>Satƒ±≈ü: <b>' + Math.round(b.val) + ' d√ºr√ºm</b>';
    tip.style.display = 'block';
    tip.style.left = Math.min(ev.clientX - rect.left - 40, rect.width - 130) + 'px';
    tip.style.top = '6px';
    setTimeout(function(){ tip.style.display = 'none'; }, 2500);
  };
}

// ‚îÄ‚îÄ‚îÄ SHARE WHATSAPP ‚îÄ‚îÄ‚îÄ
function shareWhatsApp() {
  var profit = appData.totalSales - appData.expenses;
  var pPct   = appData.totalSales > 0 ? (profit / appData.totalSales * 100) : 0;
  var wPct   = appData.suppliedPortions > 0
    ? ((appData.suppliedPortions - appData.soldPortions) / appData.suppliedPortions * 100) : 0;
  var msg = 'üç≤ *Zahra Bowl ‚Äî G√ºnl√ºk Rapor*\n' +
    'üìÖ ' + new Date(appData.date + 'T12:00:00').toLocaleDateString('tr-TR') + '\n\n' +
    'üí∞ *Finansal*\n' +
    '‚Ä¢ Gelir: ' + appData.totalSales.toLocaleString('tr-TR') + ' DH\n' +
    '‚Ä¢ Net K√¢r: ' + Math.round(profit).toLocaleString('tr-TR') + ' DH (%' + pPct.toFixed(1) + ')\n\n' +
    'ü•£ *Operasyonel*\n' +
    '‚Ä¢ Satƒ±lan Kase: ' + appData.soldPortions + ' adet\n' +
    '‚Ä¢ Atƒ±k Oranƒ±: %' + wPct.toFixed(1) + '\n\n' +
    '‚úÖ Zahra Bowl Yatƒ±rƒ±mcƒ± Paneli';
  window.open('https://wa.me/?text=' + encodeURIComponent(msg), '_blank');
  toast('WhatsApp a√ßƒ±lƒ±yor‚Ä¶', 'ok');
}

// ‚îÄ‚îÄ‚îÄ EXPORT ‚îÄ‚îÄ‚îÄ
function exportData() {
  try {
    var str = btoa(unescape(encodeURIComponent(JSON.stringify(appData))));
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(str).then(function() {
        toast('Senkronizasyon kodu kopyalandƒ±!', 'ok');
      }).catch(function() { promptCopy(str); });
    } else { promptCopy(str); }
  } catch(e) { toast('Dƒ±≈üa aktarma ba≈üarƒ±sƒ±z!', 'err'); }
}
function promptCopy(str) {
  prompt('Bu kodu kopyalayƒ±n:', str);
  toast('Kodu kopyalayƒ±n!', 'ok');
}

// ‚îÄ‚îÄ‚îÄ IMPORT ‚îÄ‚îÄ‚îÄ
function importData() {
  var str = document.getElementById('importInput').value.trim();
  if (!str) { toast('Kod bo≈ü!', 'err'); return; }
  try {
    var d = JSON.parse(decodeURIComponent(escape(atob(str))));
    appData = d;
    persist();
    document.getElementById('modal').classList.remove('show');
    document.getElementById('importInput').value = '';
    render();
    toast('Veriler senkronize edildi!', 'ok');
  } catch(e) { toast('Ge√ßersiz kod!', 'err'); }
}

// ‚îÄ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ
function toast(msg, type) {
  var wrap = document.getElementById('toastWrap');
  var el = document.createElement('div');
  el.className = 'toast' + (type ? ' ' + type : '');
  el.textContent = msg;
  wrap.appendChild(el);
  setTimeout(function() { el.remove(); }, 3000);
}

// ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ
render();
</script>
</body>
</html>
